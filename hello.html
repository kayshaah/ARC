<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ARC v1</title>
    <style>
      :root { color-scheme: light dark; }
      * { box-sizing: border-box; }
      body { margin:0; width:320px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#fff; }
      .bar { display:flex; align-items:center; justify-content:space-between; padding:12px 14px;
             background: linear-gradient(180deg,#ffffff,#f6f7f9); border-bottom:1px solid #e7e7ea; }
      .title { font-weight:700; font-size:14px; letter-spacing:.2px; color:#111; }
      .sub { padding:12px 14px; font-size:13px; color:#333; }
      .hint { font-size:12px; color:#666; margin-top:8px; }

      .switch { position:relative; width:46px; height:26px; }
      .switch input { display:none; }
      .slider { position:absolute; inset:0; background:#cfd3d8; border-radius:999px; cursor:pointer; transition:.15s ease; }
      .slider:before { content:""; position:absolute; height:20px; width:20px; left:3px; top:3px; background:#fff;
                       border-radius:50%; box-shadow:0 1px 4px rgba(0,0,0,.2); transition:.15s ease; }
      input:checked + .slider { background:#22c55e; }
      input:checked + .slider:before { transform: translateX(20px); }
      .state { font-size:12px; color:#444; margin-left:8px; min-width:30px; text-align:right; }
      .err { color:#a00; font-size:12px; margin-top:8px; display:none; }
    </style>
  </head>
  <body>
    <div class="bar">
      <div class="title">ARC v1</div>
      <div style="display:flex; align-items:center;">
        <label class="switch" title="Enable/disable ARC">
          <input id="arcToggle" type="checkbox" />
          <span class="slider"></span>
        </label>
        <span id="arcState" class="state">â€”</span>
      </div>
    </div>
    <div class="sub">
      Hover the <b>Trust</b> badge on reviews to see details.
      <div class="hint">This toggle turns ARC on/off instantly on the current Amazon tab.</div>
      <div id="err" class="err"></div>
    </div>

    <script>
      const toggle = document.getElementById('arcToggle');
      const stateEl = document.getElementById('arcState');
      const errEl = document.getElementById('err');

      function setUI(on) {
        toggle.checked = !!on;
        stateEl.textContent = on ? 'On' : 'Off';
      }

      // Get the active tab
      function getActiveTab(cb) {
        chrome.tabs.query({ active: true, currentWindow: true }, tabs => cb(tabs[0]));
      }

      // Ask content script for live status (and fall back to storage)
      function refreshStatus() {
        getActiveTab(tab => {
          if (!tab) return setUI(false);
          chrome.tabs.sendMessage(tab.id, { type: 'ARC_GET_STATUS' }, resp => {
            if (chrome.runtime.lastError) {
              // Content script might not be injected on this page
              chrome.storage.local.get({ arcEnabled: true }, s => setUI(s.arcEnabled));
              return;
            }
            setUI(!!(resp && resp.enabled));
          });
        });
      }

      // Toggle handler: save to storage AND notify active tab
      toggle.addEventListener('change', () => {
        const on = toggle.checked;
        chrome.storage.local.set({ arcEnabled: on }, () => {
          getActiveTab(tab => {
            if (!tab) return;
            chrome.tabs.sendMessage(tab.id, { type: 'ARC_TOGGLE', enabled: on }, resp => {
              if (chrome.runtime.lastError) {
                // If not an Amazon page or content script not injected, show a gentle note
                errEl.textContent = "Open an Amazon product page with reviews, then try again.";
                errEl.style.display = 'block';
              } else {
                errEl.style.display = 'none';
              }
            });
          });
        });
        setUI(on);
      });

      // Init
      chrome.storage.local.get({ arcEnabled: true }, s => setUI(s.arcEnabled));
      refreshStatus();
    </script>
  </body>
</html>
